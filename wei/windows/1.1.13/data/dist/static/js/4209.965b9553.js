/*!
 *  build: Vue  Admin Plus
 *  copyright: vue-admin-beautiful.com
 *  time: 2024-01-12 10:25:31
 */
"use strict";(self["webpackChunkadmin_plus"]=self["webpackChunkadmin_plus"]||[]).push([[4209,8123],{23471:function(e,t,n){n.d(t,{$u:function(){return y},AX:function(){return l},BX:function(){return f},Bz:function(){return s},ET:function(){return d},QC:function(){return h},RS:function(){return _},SI:function(){return g},U$:function(){return p},Vf:function(){return r},Xc:function(){return m},ar:function(){return v},co:function(){return o},m9:function(){return u},oh:function(){return w},t4:function(){return c}});var a=n(92325),i=n(11555);function o(e){return(0,a.Z)({url:"/wwwapi.php?to=suanli_image&modac=device_image",method:"get",params:{client_id:e}})}function r(e,t){return(0,a.Z)({url:"/wwwapi.php?to=suanli_image&modac=delete_image",method:"post",data:{client_id:e,image_id:t}})}function l(e){return(0,a.Z)({url:"/wwwapi.php?to=suanli_container&modac=create_container_form",method:"post",data:e})}function u(e){return(0,a.Z)({url:"/wwwapi.php?to=suanli_container&modac=create_container",method:"post",data:e})}function c(e){return(0,a.Z)({url:"/wwwapi.php?to=suanli_image&modac=pull_image",method:"post",data:e})}function s(e){return(0,a.Z)({url:"/wwwapi.php?to=suanli_image&modac=get_pull_progres",method:"post",data:{image_id:e}})}async function m(e){const{body:{hash:t}}=await(0,i.Gv)();return(0,a.Z)({url:"/wwwapi.php?to=postFavDel",method:"post",data:{favid:e,formhash:t}})}function _(e){return(0,a.Z)({url:"/wwwapi.php?to=suanli_container&modac=device_container",method:"get",params:{client_id:e}})}function d(e,t){return(0,a.Z)({url:"/wwwapi.php?to=suanli_container&modac=container_restart",method:"post",data:{client_id:e,container_id:t}})}function p(e,t){return(0,a.Z)({url:"/wwwapi.php?to=suanli_container&modac=container_stop",method:"post",data:{client_id:e,container_id:t}})}function f(e,t){return(0,a.Z)({url:"/wwwapi.php?to=suanli_container&modac=delete_container",method:"post",data:{client_id:e,container_id:t}})}function g(e){return(0,a.Z)({url:"/wwwapi.php?to=suanli_model&modac=device_model",method:"get",params:{client_id:e}})}function w(){return(0,a.Z)({url:"/wwwapi.php?to=suanli_model&modac=download_form",method:"post"})}function h(e){return(0,a.Z)({url:"/wwwapi.php?to=suanli_model&modac=download_model",method:"post",data:e})}function v(e,t){return(0,a.Z)({url:"/wwwapi.php?to=suanli_model&modac=model_apply",method:"get",data:{client_id:e,host_model_id:t}})}function y(e){return(0,a.Z)({url:"/wwwapi.php?to=suanli_model&modac=model_delete",method:"get",params:{host_model_id:e}})}},81464:function(e,t,n){n.d(t,{Z:function(){return l}});var a=n(81095),i=n(26593);function o(e){a.gp.$baseMessage(`拷贝${e}成功`,"success","vab-hey-message-success",!1)}function r(e){a.gp.$baseMessage(`拷贝${e}失败`,"error","vab-hey-message-success",!1)}function l(e){const{isSupported:t,copy:n}=(0,i.VPI)();t||(0,i.gIw)("clipboard-write"),n(e).then((()=>{o(e)})).catch((t=>{console.log(t),r(e)}))}},61653:function(e,t,n){n.d(t,{E:function(){return l},p:function(){return u}});var a=n(27484),i=n.n(a),o=(n(33852),n(84110)),r=n.n(o);function l(e){return i().locale("zh-cn"),i()(e).fromNow()}function u(e,t="YYYY-MM-DD HH:mm:ss"){return i()(e).format(t)}i().extend(r())},42238:function(e,t,n){n.d(t,{Z:function(){return r}});var a=n(22201),i=n(2262),o=n(66252);function r(e){const t=(0,a.yj)(),n=(0,i.iH)(t.params.id);return(0,o.YP)((()=>t.params.id),(()=>{n.value=t.params.id,e()})),{paramsId:n}}},95965:function(e,t,n){function a(){function e(e,t=2e3){return setInterval((()=>{e()}),t)}function t(e){e&&clearInterval(e)}return{startIntervalTimer:e,stopIntervalTimer:t}}n.d(t,{Z:function(){return a}})},85026:function(e,t,n){n.d(t,{M:function(){return i},b:function(){return a}});const a={container_name:[{required:!0,message:"容器名称必填",trigger:"change"}],persion_input_image_src:[{required:!0,message:"镜像地址必填",trigger:"change"}]},i={persion_input_image_src:[{required:!0,message:"镜像地址必填",trigger:"change"}]}},48123:function(e,t,n){n.r(t),n.d(t,{default:function(){return c}});var a=n(66252),i=n(2262),o=n(81464),r={__name:"index",props:{text:{type:String,default:""}},setup(e){return(t,n)=>{const r=(0,a.up)("vab-icon");return(0,a.wg)(),(0,a.j4)(r,{icon:"file-copy-2-line",class:"cursor-pointer",onClick:n[0]||(n[0]=t=>(0,i.SU)(o.Z)(e.text))})}}};function l(e){e.__source="src/components/ClipboardButton/index.vue"}"function"===typeof l&&l(r);const u=r;var c=u},50796:function(e,t,n){n.r(t),n.d(t,{default:function(){return h}});var a=n(15659),i=(n(3241),n(10444),n(20129)),o=(n(69840),n(10661)),r=(n(35095),n(63715)),l=(n(76252),n(72319),n(6589),n(57018)),u=(n(74367),n(66252)),c=n(2262),s=n(86136),m=n(23471),_=n(85026);const d={class:"comprehensive-form-container"};var p={__name:"create_container_dialog",emits:["finish"],setup(e,{expose:t,emit:n}){const p=(0,c.iH)(!1),f=(0,c.iH)(),g=()=>({client_id:"",create_from_where:"image_list",device_image_id:0,persion_input_image_src:"",container_name:"",container_ports:"",container_paths:"",host_gpu_select:[]}),w=(0,c.iH)([]),h=(0,c.iH)({...g()}),v=(0,c.iH)({..._.b}),y=(0,u.Fl)((()=>0==h.value.device_image_id));async function k(e,t=0){b(e,t),p.value=!0,h.value={...g(),client_id:e,create_from_where:t>0?"image_list":"extra_path",device_image_id:t,persion_input_image_src:""},(0,u.Y3)((()=>{f.value.clearValidate()}))}async function b(e,t){let n;n=t>0?{client_id:e,create_from_where:"image_list",device_image_id:t}:{client_id:e,create_from_where:"extra_path",device_image_id:0};const{body:a}=await(0,m.AX)(n);w.value=a.host_gpu_digital_ids}async function U(){await f.value.validate((async(e,t)=>{if(!e)return!1;await(0,m.m9)(h.value);p.value=!1,n("finish")}))}return t({showDialog:k}),(e,t)=>{const n=l.EZ,m=i.nH,_=r.lm,g=r.z5,k=(0,u.up)("vab-icon"),b=o.Q0,W=i.ly,Z=a.ElButton;return(0,u.wg)(),(0,u.iD)("div",d,[(0,u.Wm)((0,c.SU)(s["default"]),{modelValue:(0,c.SU)(p),"onUpdate:modelValue":t[6]||(t[6]=e=>(0,c.dq)(p)?p.value=e:null),title:"创建容器",width:"600px"},{footer:(0,u.w5)((()=>[(0,u.Wm)(Z,{onClick:t[5]||(t[5]=e=>p.value=!1)},{default:(0,u.w5)((()=>[(0,u.Uk)("取 消")])),_:1}),(0,u.Wm)(Z,{type:"primary",onClick:U},{default:(0,u.w5)((()=>[(0,u.Uk)(" 确 定 ")])),_:1})])),default:(0,u.w5)((()=>[(0,u.Wm)(W,{ref_key:"formRef",ref:f,class:"demo-form",model:(0,c.SU)(h),rules:(0,c.SU)(v),"label-width":"auto"},{default:(0,u.w5)((()=>[(0,u.Wm)(m,{label:"容器名称",prop:"container_name"},{default:(0,u.w5)((()=>[(0,u.Wm)(n,{modelValue:(0,c.SU)(h).container_name,"onUpdate:modelValue":t[0]||(t[0]=e=>(0,c.SU)(h).container_name=e),placeholder:"创建完成后好在对应设备的“我的容器”中找它",class:"contianer-name"},null,8,["modelValue"])])),_:1}),(0,u.Wm)(m,{label:"GPU编号"},{default:(0,u.w5)((()=>[(0,u.Wm)(g,{modelValue:(0,c.SU)(h).host_gpu_select,"onUpdate:modelValue":t[1]||(t[1]=e=>(0,c.SU)(h).host_gpu_select=e)},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)((0,c.SU)(w),(e=>((0,u.wg)(),(0,u.j4)(_,{key:e.gpu_digital_id,label:e.gpu_digital_id},null,8,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,c.SU)(y)?((0,u.wg)(),(0,u.j4)(m,{key:0,label:"设定镜像",prop:"persion_input_image_src"},{default:(0,u.w5)((()=>[(0,u.Wm)(n,{modelValue:(0,c.SU)(h).persion_input_image_src,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,c.SU)(h).persion_input_image_src=e),placeholder:"镜像不在本地和镜像市场收藏夹，手动输入镜像地址",class:"contianer-name"},null,8,["modelValue"])])),_:1})):(0,u.kq)("",!0),(0,u.Wm)(m,{label:"映射端口"},{default:(0,u.w5)((()=>[(0,u.Wm)(n,{modelValue:(0,c.SU)(h).container_ports,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,c.SU)(h).container_ports=e),placeholder:"例如：7680|80|3306，多个用英文“|”隔开",class:"contianer-name-helf"},null,8,["modelValue"]),(0,u.Wm)(b,{effect:"dark",content:"容器要映射的出来的内部端口，仅需填写镜像内的端口，最多4个，或者不填",placement:"top",class:"mx-1","raw-content":""},{default:(0,u.w5)((()=>[(0,u.Wm)(k,{icon:"question-line",class:"cursor-pointer"})])),_:1})])),_:1}),(0,u.Wm)(m,{label:"映射路径"},{default:(0,u.w5)((()=>[(0,u.Wm)(n,{modelValue:(0,c.SU)(h).container_paths,"onUpdate:modelValue":t[4]||(t[4]=e=>(0,c.SU)(h).container_paths=e),placeholder:"例如：/root/sd/models|/root/data，多个路径用英文“|”隔开",class:"contianer-name-helf"},null,8,["modelValue"]),(0,u.Wm)(b,{effect:"dark",content:"系统按顺序提供宿主机的模型公用目录/root/model和用户私有数据目录/root/data映射。<br>仅需写镜像内映射的路径，请对照好顺序填入镜像内对应的目录，或者不填",placement:"top",class:"mx-1","raw-content":""},{default:(0,u.w5)((()=>[(0,u.Wm)(k,{icon:"question-line",class:"cursor-pointer"})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}}};function f(e){e.__source="src/views/gpumarket/mydevice/components/create_container_dialog.vue"}var g=n(83744);"function"===typeof f&&f(p);const w=(0,g.Z)(p,[["__scopeId","data-v-44bfd02c"]]);var h=w},54209:function(e,t,n){n.r(t),n.d(t,{default:function(){return Z}});var a=n(3837),i=(n(3241),n(81010),n(76128)),o=(n(74828),n(50591)),r=(n(89035),n(15659)),l=(n(10444),n(32018)),u=(n(46160),n(50363),n(10661)),c=(n(35095),n(57658),n(66252)),s=n(2262),m=n(3577),_=n(96486),d=n(23471),p=n(61653),f=n(50796),g=n(48123),w=n(95965),h=n(42238);const v={key:1},y={class:"el-progress-action"};var k={__name:"image_list",setup(e){const t=(0,c.f3)("$sub"),n=(0,c.f3)("$unsub"),k=(0,c.f3)("$pub"),{startIntervalTimer:b,stopIntervalTimer:U}=(0,w.Z)(),W=(0,s.iH)([]),Z=(0,c.Fl)((()=>W.value.map((e=>(e.link=e.img_forum_id>0?`/gpumarket/image/${e.img_forum_id}`:"",e.diff_time=e.img_create_time?(0,p.E)(e.img_create_time):"",e.cut_img_name=(0,_.truncate)(e.img_name,{length:35,separator:"..."}),e))))),{paramsId:S}=(0,h.Z)((()=>{V()}));async function V(){const{body:e}=await(0,d.co)(S.value);W.value=e,H(e),j(e)}let x;t("reload-image-list",(()=>{V()})),(0,c.bv)((()=>{V()})),(0,c.Ah)((()=>{U(x),U(C),n("reload-image-list")}));let C,I={};function H(e){const t=e.filter((e=>e.img_operation_array.showProcess));I={},U(x),0!==t.length&&(x=b((async()=>{const e=[],n=[];for(const o of t)e.push((0,d.Bz)(o.img_id)),n.push(o.img_id);const a=await Promise.all(e);let i=!1;for(let t=n.length-1;t>=0;t--){const{body:{progress_num:e,progress_text:o}}=a[t],r=n[t],l=W.value.find((e=>e.img_id===r));l.img_operation_array.progress_num=parseInt(e),l.img_operation_array.progress_text=o,I[r]={progress_num:parseInt(e),progress_text:o},parseInt(e)>=100&&(i=!0)}t.length<=0&&U(x),i&&V()})))}function j(e){const t=e.filter((e=>e.img_operation_array.time_flash_list));U(C),0!==t.length&&(C=b((async()=>{const{body:e}=await(0,d.co)(S.value);for(const n in I){const t=I[n],a=e.find((e=>e.img_id===n));a&&Object.assign(a.img_operation_array,t)}W.value=e;const t=e.filter((e=>e.img_operation_array.time_flash_list));t.length<=0&&U(C)}),5e3))}const z=(0,s.iH)();async function q(e){z.value.showDialog(S.value,e)}async function D(e){await(0,d.Vf)(S.value,e),V()}async function $(e){const t={client_id:S.value,create_from_where:"image_list",image_thread_id:e,persion_input_image_src:""};await(0,d.t4)(t),V()}async function Y(e){await(0,d.Xc)(e),V()}function B(){k("active-device-tab",{name:"docker-list",callback:()=>{k("reload-docker-list")}})}return(e,t)=>{const n=(0,c.up)("router-link"),_=u.Q0,d=a.$Y,p=(0,c.up)("vab-icon"),w=l.Xh,h=r.ElButton,k=o.i1,b=i.GT,U=a.eI;return(0,c.wg)(),(0,c.iD)(c.HY,null,[(0,c.Wm)(U,{fit:"",flexible:"",stripe:"","table-layout":"auto",data:(0,s.SU)(Z),"row-key":e.img_id,class:"data-list"},{empty:(0,c.w5)((()=>[(0,c.Wm)(b,{class:"vab-data-empty",description:"本机暂时没有镜像，请到镜像市场选择心仪的镜像并收藏，然后就能在这里拉取啦"})])),default:(0,c.w5)((()=>[(0,c.Wm)(d,{label:"镜像名称",prop:"img_name"},{default:(0,c.w5)((({row:e})=>[(0,c.Wm)(_,{placement:"top",content:e.img_name},{default:(0,c.w5)((()=>[e.link?((0,c.wg)(),(0,c.j4)(n,{key:0,to:e.link},{default:(0,c.w5)((()=>[(0,c.Uk)((0,m.zw)(e.cut_img_name),1)])),_:2},1032,["to"])):((0,c.wg)(),(0,c.iD)("span",v,(0,m.zw)(e.cut_img_name),1))])),_:2},1032,["content"]),(0,c.Wm)((0,s.SU)(g["default"]),{text:e.img_name},null,8,["text"])])),_:1}),(0,c.Wm)(d,{label:"TAG",prop:"img_tag"}),(0,c.Wm)(d,{label:"大小",prop:"img_size"}),(0,c.Wm)(d,{label:"状态",prop:"img_status_str"},{default:(0,c.w5)((({row:e})=>[(0,c.Uk)((0,m.zw)(e.img_status_str)+" ",1),e.img_hint?((0,c.wg)(),(0,c.j4)(_,{key:0,placement:"top",content:e.img_hint},{default:(0,c.w5)((()=>[(0,c.Wm)(p,{icon:"error-warning-line",style:(0,m.j5)({color:"var(--el-color-danger)"})},null,8,["style"])])),_:2},1032,["content"])):(0,c.kq)("",!0)])),_:1}),(0,c.Wm)(d,{label:"创建时间",prop:"diff_time"}),(0,c.Wm)(d,{label:"位置",prop:"img_where_str",sortable:""}),(0,c.Wm)(d,{label:"操作",prop:"truedata"},{default:(0,c.w5)((({row:e})=>[(0,c._)("div",y,[e.img_operation_array.showProcess?((0,c.wg)(),(0,c.j4)(w,{key:0,"text-inside":!0,"stroke-width":20,percentage:e.img_operation_array.progress_num,striped:"",status:e.img_operation_array.progress_text,size:"small"},null,8,["percentage","status"])):((0,c.wg)(),(0,c.iD)(c.HY,{key:1},[e.img_operation_array.showPullButtun?((0,c.wg)(),(0,c.j4)(h,{key:0,type:"primary",size:"small",onClick:t=>$(e.img_forum_id)},{default:(0,c.w5)((()=>[(0,c.Uk)(" 拉取 ")])),_:2},1032,["onClick"])):(0,c.kq)("",!0),e.img_operation_array.createContainer?((0,c.wg)(),(0,c.j4)(h,{key:1,type:"primary",size:"small",onClick:t=>q(e.img_id)},{default:(0,c.w5)((()=>[(0,c.Uk)(" 创建容器 ")])),_:2},1032,["onClick"])):(0,c.kq)("",!0)],64)),e.img_operation_array.delete?((0,c.wg)(),(0,c.j4)(k,{key:2,title:"确定删除此镜像吗？",onConfirm:t=>D(e.img_id)},{reference:(0,c.w5)((()=>[(0,c.Wm)(h,{type:"danger",size:"small"},{default:(0,c.w5)((()=>[(0,c.Uk)("删除")])),_:1})])),_:2},1032,["onConfirm"])):(0,c.kq)("",!0),e.img_favid?((0,c.wg)(),(0,c.j4)(k,{key:3,title:"确定取消收藏此镜像？",onConfirm:t=>Y(e.img_favid)},{reference:(0,c.w5)((()=>[(0,c.Wm)(h,{type:"warning",size:"small"},{default:(0,c.w5)((()=>[(0,c.Uk)("取消收藏")])),_:1})])),_:2},1032,["onConfirm"])):(0,c.kq)("",!0)])])),_:1})])),_:1},8,["data","row-key"]),(0,c.Wm)(f["default"],{ref_key:"createContainerDialogRef",ref:z,onFinish:B},null,512)],64)}}};function b(e){e.__source="src/views/gpumarket/mydevice/components/image_list.vue"}var U=n(83744);"function"===typeof b&&b(k);const W=(0,U.Z)(k,[["__scopeId","data-v-98beca10"]]);var Z=W}}]);