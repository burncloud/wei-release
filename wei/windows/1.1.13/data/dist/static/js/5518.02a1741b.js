/*!
 *  build: Vue  Admin Plus
 *  copyright: vue-admin-beautiful.com
 *  time: 2024-01-12 10:25:31
 */
"use strict";(self["webpackChunkadmin_plus"]=self["webpackChunkadmin_plus"]||[]).push([[5518],{4031:function(e,t,n){n.d(t,{$t:function(){return f},BS:function(){return m},Cw:function(){return r},Fd:function(){return i},Q2:function(){return d},R:function(){return w},Ts:function(){return l},Uq:function(){return p},g:function(){return s},n8:function(){return u},ob:function(){return o},tw:function(){return c}});var a=n(54258);function s(){return(0,a.Z)({url:"/run",method:"post",data:["wei-docker","download"]})}function r(){return(0,a.Z)({url:"/run",method:"post",data:["wei-docker","download_check"]})}function i(){return(0,a.Z)({url:"/run",method:"post",data:["wei-docker","install"]})}function o(){return(0,a.Z)({url:"/run",method:"post",data:["wei-docker","check"]})}function l(){return(0,a.Z)({url:"/run",method:"post",data:["wei-docker","is_installed"]})}function u(){return(0,a.Z)({url:"/run",method:"post",data:["wei-docker","wsl_update"]})}function d(){return(0,a.Z)({url:"/run",method:"post",data:["wei-docker","uninstall"]})}function c(){return(0,a.Z)({url:"/run",method:"post",data:["wei-docker","is_started"]})}function w(){return(0,a.Z)({url:"/run",method:"post",data:["wei-docker","docker_service_auto_start"]})}function f(){return(0,a.Z)({url:"/run",method:"post",data:["wei-docker","docker_service_auto_stop"]})}function m(){return(0,a.Z)({url:"/run/async",method:"post",data:["wei-docker","start"]})}function p(){return(0,a.Z)({url:"/run",method:"post",data:["wei-docker","stop"]})}},54258:function(e,t,n){var a=n(42785),s=n(80129),r=n.n(s),i=n(66443),o=n(20345),l=n(81095),u=n(6154);let d;const c=(0,i.kJ)(a.successCode)?[...a.successCode]:[a.successCode],w={200:"服务器成功返回请求数据",201:"新建或修改数据成功",202:"一个请求已经进入后台排队(异步任务)",204:"删除数据成功",400:"发出信息有误",401:"用户没有权限(令牌失效、用户名、密码错误、登录过期)",402:"令牌过期",403:"用户得到授权，但是访问是被禁止的",404:"访问资源不存在",406:"请求格式不可得",410:"请求资源被永久删除，且不会被看到",500:"本地服务器还没开启",502:"网关错误",503:"服务不可用，服务器暂时过载或维护",504:"网关超时"},f=e=>(e.data&&"application/x-www-form-urlencoded;charset=UTF-8"===e.headers["Content-Type"]&&(e.data=r().stringify(e.data)),a.debounce.some((t=>e.url.includes(t)))&&(d=l.gp.$baseLoading()),e),m=async({config:e,data:t,status:n,statusText:s})=>{d&&d.close();let r=t&&t[a.statusName]?t[a.statusName]:n;switch(c.indexOf(t[a.statusName])+1&&(r=200),r){case 200:return t;case 401:break;case 402:break;case 403:break}const i=`${t&&t[a.messageName]?t[a.messageName]:w[r]?w[r]:"本地服务未开启，无法访问"}`;return l.gp.$baseMessage(i,"error","vab-hey-message-error",!1),(0,o.needErrorLog)()&&(0,o.addErrorLog)({message:i,stack:t,isRequest:!0}),Promise.reject(t)},p=sessionStorage.getItem("server_address")||"http://127.0.0.1:1115/",g=u.Z.create({baseURL:p,timeout:a.requestTimeout,headers:{"Content-Type":a.contentType}});g.interceptors.request.use(f,(e=>Promise.reject(e))),g.interceptors.response.use((e=>m(e)),(e=>{const{response:t,code:n}=e;switch(n){case"ERR_CANCELED":return{};case"ECONNABORTED":return l.gp.$baseMessage("请求超时","error","vab-hey-message-error",!1),{};default:break}return void 0===t?(d&&d.close(),l.gp.$baseMessage("连接后台接口失败，可能由以下原因造成：后端不支持跨域CORS、接口地址不存在、请求超时等，请联系管理员排查后端接口问题 ","error","vab-hey-message-error",!1),{}):m(t)})),t.Z=g},85518:function(e,t,n){n.r(t),n.d(t,{default:function(){return P}});var a=n(73481),s=(n(3241),n(62029),n(73632)),r=(n(74965),n(20129)),i=(n(69840),n(87692)),o=(n(45393),n(22411),n(85381)),l=(n(68538),n(6589),n(50591)),u=(n(89035),n(15659)),d=(n(10444),n(22040)),c=(n(99426),n(66263)),w=(n(33790),n(32018)),f=(n(46160),n(27682)),m=(n(98661),n(83495),n(66252)),p=n(2262),g=n(26593),_=n(4031),k=n(88600),v=n.n(k);function h(e){return v()(parseFloat(e))}var y=n(95965);const b=e=>((0,m.dD)("data-v-4117db95"),e=e(),(0,m.Cn)(),e),U={class:"step-form-container"},S={class:"mt-4 mb-4"},I={key:0},W=b((()=>(0,m._)("div",null,"检查是否下载Ubuntu.tar.gz和wsl_update_x64.msi",-1))),C={key:0,class:"mt-2 mb-2"},R={key:1},q={key:2},D={key:3},Z={key:4},x={key:5},L={key:6},$={class:"pay-button-group"},T={class:"flex w-full"},j={class:"flex w-full"},E={class:"flex w-full"},N=b((()=>(0,m._)("p",null," 1/系统在第一次初始化的时候，会自动重启一次，请在执行初始化前先保存好电脑上的资料。 ",-1))),F=b((()=>(0,m._)("p",null," 2/如果系统重启后会自动的再次进入初始化设备操作，如果没有自动运行，请手动再点一次“初始化设备”，选择继续 ",-1))),V=b((()=>(0,m._)("p",null," 3/后端服务需要开启以后才可以设置设备出租和挂机。如果您手工开启关闭麻烦，请选择开机默认开启后端服务。 ",-1)));var B={__name:"init_dialog",setup(e,{expose:t}){const{startIntervalTimer:n,stopIntervalTimer:k}=(0,y.Z)(),v=(0,m.f3)("$pub"),b=(0,m.f3)("$sub"),B=(0,m.f3)("$unsub"),O=(0,m.f3)("deviceData"),H=(0,p.iH)(!1);(0,m.Ah)((()=>{B("watch-download-progress"),B("watch-install-progress")}));const M=(0,m.Fl)((()=>{if(!O.status.file_check)return 0;const e={hyper:1,wsl:2,wsl2:3,wsl_update:4,ubuntu:5};let t=0;for(const n in e)if(O.status[n]){const a=e[n]+1;t=a>t?a:t}return O.isInstalled&&(t=6),t}));function P(){te(),H.value=!0,(0,_.Ts)().then((({is_installed:e})=>{O.isInstalled=e})),O.timer||(0,_.ob)().then((({progress:e})=>{O.status=e}))}function A(){H.value=!1}function Q(e){return 100===e?"下载完毕":`正在下载文件 ${O.downloadSpeed??"0 B"}/s ${e}%`}async function X(){O.isRunInit=!0,localStorage.removeItem("cancel-init-device"),O.status.file_check?J():(O.timer||v("watch-download-progress"),await(0,_.g)())}function z(){O.isRunInit=!1,localStorage.setItem("cancel-init-device",!0),k(O.timer)}async function G(){O.isRunInit||k(O.timer);const{data:e}=await(0,_.Cw)(),{download_speed:t,completed_length:n,total_length:a}=e;if(n&&a){const e=Math.round(n/a*100);O.downloadPercent=e}O.downloadSpeed=h(t)||"",parseInt(n)>=parseInt(a)&&(O.isDownloaded=!0,k(O.timer),J())}async function J(){v("watch-install-progress"),await(0,_.Fd)()}async function K(){try{O.isUnInstall=!0,await(0,_.Q2)(),O.isRunInit=!1,O.isInstalled=!1;const{progress:e}=await(0,_.ob)();O.status=e}catch(e){}finally{O.isUnInstall=!1}}b("watch-download-progress",(()=>{O.isRunInit=!0,O.timer=n((()=>{G()}))})),b("watch-install-progress",(()=>{let e=!1;O.timer=n((async()=>{const{progress:t}=await(0,_.ob)();if(O.status=t,e||!O.status.wsl2||O.status.wsl_update||(await(0,_.n8)(),e=!0),O.status.ubuntu&&!O.isInstalled){const{is_installed:e}=await(0,_.Ts)();O.isInstalled=e,e&&(k(O.timer),ne())}}))}));const Y=(0,g.y$C)("is-service-auto-start",!0),ee=(0,p.iH)(!1);async function te(){if(!O.isDownloaded||!O.isInstalled)return;const{is_start:e}=await(0,_.tw)();O.isStarted=e,ee.value=!1}async function ne(){Y.value?await(0,_.R)():await(0,_.$t)()}async function ae(){if(!O.isInstalled)return!1;ee.value=!0,await(0,_.BS)(),te()}async function se(){if(!O.isInstalled)return!1;ee.value=!0,await(0,_.Uq)(),te()}return t({showDialog:P}),(e,t)=>{const n=f.Gg,g=f.C4,_=w.Xh,k=c.v,v=d.Dv,h=u.ElButton,y=l.i1,b=r.nH,B=o.OX,P=i.dn,G=i.KD,J=r.ly,te=s.dq,re=a.d0;return(0,m.wg)(),(0,m.j4)(re,{modelValue:(0,p.SU)(H),"onUpdate:modelValue":t[2]||(t[2]=e=>(0,p.dq)(H)?H.value=e:null),title:"初始化设备",width:"50%","close-on-click-modal":!1,"close-on-press-escape":!1,onClose:A},{default:(0,m.w5)((()=>[(0,m._)("div",U,[(0,m.Wm)(te,{gutter:20},{default:(0,m.w5)((()=>[(0,m.Wm)(v,null,{default:(0,m.w5)((()=>[(0,m.Wm)(g,{active:(0,p.SU)(M),"align-center":"",class:"steps"},{default:(0,m.w5)((()=>[(0,m.Wm)(n,{description:"软件检测",title:"File_check"}),(0,m.Wm)(n,{description:"设置hyper",title:"Hyper setting"}),(0,m.Wm)(n,{description:"安装WSL",title:"WSL Install"}),(0,m.Wm)(n,{description:"设置WSL",title:"WSL setting"}),(0,m.Wm)(n,{description:"更新系统",title:"WSL update"}),(0,m.Wm)(n,{description:"安装Linux",title:"Install Linux"}),(0,m.Wm)(n,{description:"完成",title:"Finish"})])),_:1},8,["active"]),(0,m._)("div",S,[0===(0,p.SU)(M)?((0,m.wg)(),(0,m.iD)("div",I,[W,(0,p.SU)(O).isRunInit?((0,m.wg)(),(0,m.iD)("div",C,[(0,m.Wm)(_,{"text-inside":!0,"stroke-width":26,percentage:(0,p.SU)(O).downloadPercent,format:Q},null,8,["percentage"])])):(0,m.kq)("",!0)])):(0,m.kq)("",!0),1===(0,p.SU)(M)?((0,m.wg)(),(0,m.iD)("div",R," 设置 bcdedit /set hypervisorlaunchtype ")):(0,m.kq)("",!0),2===(0,p.SU)(M)?((0,m.wg)(),(0,m.iD)("div",q,[(0,m.Uk)(" 安装WSL，安装完毕后将自动重启，然后再执行一次设备初始化。 "),(0,m.Wm)(k,null,{default:(0,m.w5)((()=>[(0,m.Uk)(" 重启以后重新打开软件，再次进入初始化设置界面，再点一次初始化，完成最后安装。 ")])),_:1})])):(0,m.kq)("",!0),3===(0,p.SU)(M)?((0,m.wg)(),(0,m.iD)("div",D,"设置WSL运行环境")):(0,m.kq)("",!0),4===(0,p.SU)(M)?((0,m.wg)(),(0,m.iD)("div",Z,"安装wsl_update_x64")):(0,m.kq)("",!0),5===(0,p.SU)(M)?((0,m.wg)(),(0,m.iD)("div",x,"安装Linux系统")):(0,m.kq)("",!0),6===(0,p.SU)(M)?((0,m.wg)(),(0,m.iD)("div",L,"初始化完成")):(0,m.kq)("",!0)])])),_:1}),(0,m.Wm)(v,null,{default:(0,m.w5)((()=>[(0,m._)("div",$,[(0,m.Wm)(J,{ref:"formRef",model:e.form,rules:e.rules,"label-width":"auto"},{default:(0,m.w5)((()=>[(0,p.SU)(O).isInstalled?((0,m.wg)(),(0,m.j4)(b,{key:1,label:"操作"},{default:(0,m.w5)((()=>[(0,m._)("div",j,[(0,m.Wm)(h,{loading:(0,p.SU)(O).isUnInstall,type:"primary",onClick:K},{default:(0,m.w5)((()=>[(0,m.Uk)(" 卸载 ")])),_:1},8,["loading"])])])),_:1})):((0,m.wg)(),(0,m.j4)(b,{key:0,label:"初始化操作"},{default:(0,m.w5)((()=>[(0,m._)("div",T,[(0,p.SU)(O).status.first_reboot?((0,m.wg)(),(0,m.j4)(h,{key:0,loading:(0,p.SU)(O).isRunInit,type:"primary",onClick:X},{default:(0,m.w5)((()=>[(0,m.Uk)(" 开始初始化 ")])),_:1},8,["loading"])):((0,m.wg)(),(0,m.j4)(y,{key:1,title:"系统在第一次初始化的时候，需要重启一次，点击确定将会重启！",onConfirm:X},{reference:(0,m.w5)((()=>[(0,m.Wm)(h,{loading:(0,p.SU)(O).isRunInit,type:"primary"},{default:(0,m.w5)((()=>[(0,m.Uk)(" 开始初始化 ")])),_:1},8,["loading"])])),_:1})),(0,p.SU)(O).isRunInit?((0,m.wg)(),(0,m.j4)(h,{key:2,onClick:z},{default:(0,m.w5)((()=>[(0,m.Uk)(" 取消 ")])),_:1})):(0,m.kq)("",!0)])])),_:1})),(0,m.Wm)(b,{label:"后端服务"},{default:(0,m.w5)((()=>[(0,m._)("div",E,[(0,m.Wm)(B,{"model-value":(0,p.SU)(O).isStarted,loading:(0,p.SU)(ee),"active-text":"开启","inactive-text":"关闭",onChange:t[0]||(t[0]=e=>e?ae():se())},null,8,["model-value","loading"]),(0,m.Wm)(G,{modelValue:(0,p.SU)(Y),"onUpdate:modelValue":t[1]||(t[1]=e=>(0,p.dq)(Y)?Y.value=e:null),class:"ml-4",onChange:ne},{default:(0,m.w5)((()=>[(0,m.Wm)(P,{label:!0},{default:(0,m.w5)((()=>[(0,m.Uk)(" 默认自动开启 ")])),_:1}),(0,m.Wm)(P,{label:!1},{default:(0,m.w5)((()=>[(0,m.Uk)("默认关闭")])),_:1})])),_:1},8,["modelValue"])])])),_:1})])),_:1},8,["model","rules"])])])),_:1}),(0,m.Wm)(v,null,{default:(0,m.w5)((()=>[(0,m.Wm)(k,{closable:!1},{default:(0,m.w5)((()=>[N,F,V])),_:1})])),_:1})])),_:1})])])),_:1},8,["modelValue"])}}};function O(e){e.__source="src/views/gpumarket/mydevice/components/init_dialog.vue"}var H=n(83744);"function"===typeof O&&O(B);const M=(0,H.Z)(B,[["__scopeId","data-v-4117db95"]]);var P=M}}]);