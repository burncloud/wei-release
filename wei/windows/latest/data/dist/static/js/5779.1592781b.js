/*!
 *  build: Vue  Admin Plus
 *  copyright: vue-admin-beautiful.com
 *  time: 2023-11-06 12:25:27
 */
"use strict";(self["webpackChunkadmin_plus"]=self["webpackChunkadmin_plus"]||[]).push([[5779],{23051:function(e,r,t){t.d(r,{NQ:function(){return i},UF:function(){return l},az:function(){return n},dw:function(){return d},oU:function(){return o}});var a=t(66443);const o={mobile:[{required:!0,trigger:"blur",validator:(e,r,t)=>{""===r?t(new Error("手机号码不能为空")):t()}},{trigger:"blur",validator(e,r,t){return(0,a.Mn)(r)},message:"手机号码格式错误"}],passwd:[{required:!0,trigger:"blur",validator:(e,r,t)=>{(0,a.L6)(r)?t():t(new Error("密码不能少于6位"))}}],seccodeverify:{required:!0,trigger:"blur",message:"验证码不能空"}},i={mobile:[{required:!0,message:"手机号码必填",trigger:"blur"},{trigger:"blur",validator(e,r,t){return(0,a.Mn)(r)},message:"手机号码格式错误"}],seccodeverify:{required:!0,trigger:"blur",message:"验证码不能空"},smscode:{required:!0,trigger:"blur",message:"手机验证码必填"}},n={realname:[{required:!0,message:"真实姓名必填",trigger:"change"},{validator(e,r,t){return(0,a.Ur)(r)},message:"姓名必须是中文",trigger:"change"}],idcard:[{required:!0,message:"身份证必填",trigger:"change"},{validator(e,r,t){return(0,a.tR)(r)},message:"身份证格式错误",trigger:"change"}]},d={newpassword:[{required:!0,trigger:"blur",message:"新密码不能少于6位",validator:(e,r,t)=>(0,a.L6)(r)}]},l={password:[{required:!0,trigger:"blur",message:"密码不能为空！"}]}},55779:function(e,r,t){t.r(r),t.d(r,{default:function(){return T}});var a=t(73481),o=(t(3241),t(62029),t(20129)),i=(t(69840),t(6589),t(57018)),n=(t(74367),t(66263)),d=(t(33790),t(3837)),l=(t(81010),t(15659)),m=(t(10444),t(31040)),s=(t(86709),t(14132)),c=(t(50986),t(61715),t(50363),t(66252)),u=t(3577),f=t(49963);const g={class:"dialog-footer"};function _(e,r,t,_,p,w){const h=d.$Y,b=s.BT,v=s.ElSelect,y=m.d6,D=l.ElButton,x=d.eI,V=n.v,C=i.EZ,W=o.nH,k=o.ly,U=a.d0;return(0,c.wg)(),(0,c.iD)(c.HY,null,[(0,c.Wm)(x,{data:e.formOptionList,style:{width:"100%","margin-bottom":"20px"}},{default:(0,c.w5)((()=>[(0,c.Wm)(h,{prop:"from_name",label:"积分类型"}),(0,c.Wm)(h,{prop:"from_max_credits",label:"积分数量"}),(0,c.Wm)(h,{prop:"",label:"兑换的目标积分类型",width:"190"},{default:(0,c.w5)((({row:r})=>[(0,c.Wm)(v,{modelValue:r.to_credit_id,"onUpdate:modelValue":e=>r.to_credit_id=e,placeholder:"请选择",onChange:t=>e.changeCreditRate(r)},{default:(0,c.w5)((()=>[((0,c.wg)(!0),(0,c.iD)(c.HY,null,(0,c.Ko)(r.rates,(e=>((0,c.wg)(),(0,c.j4)(b,{key:e.credit_id,label:e.title,value:e.credit_id},{default:(0,c.w5)((()=>[(0,c.Uk)((0,u.zw)(e.title),1)])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),(0,c.Wm)(h,{prop:"",label:"兑出数量",width:"180"},{default:(0,c.w5)((({row:r})=>[(0,c.Wm)(y,{modelValue:r.from_credits,"onUpdate:modelValue":e=>r.from_credits=e,step:1,min:0,max:r.from_max_credits,onChange:t=>e.changeCreditRate(r)},null,8,["modelValue","onUpdate:modelValue","max","onChange"])])),_:1}),(0,c.Wm)(h,{prop:"to_credits",label:"得到目标积分",width:"130"}),(0,c.Wm)(h,{prop:"",label:"操作"},{default:(0,c.w5)((({row:r})=>[(0,c.Wm)(D,{size:"small",type:"primary",disabled:0==r.from_credits,onClick:t=>e.exchangeCreditPrompt(r)},{default:(0,c.w5)((()=>[(0,c.Uk)(" 兑换 ")])),_:2},1032,["disabled","onClick"])])),_:1})])),_:1},8,["data"]),(0,c.Wm)(V,{closable:!1,"show-icon":"",title:"积分兑换在兑换完成后，具有不可逆的性质，兑换前请慎重选择兑入的积分类型。如果选错兑入积分类型导致自身权益损失，平台将不会作出任何补偿或赔偿",type:"info"}),(0,c.Wm)(U,{modelValue:e.dialogVisible,"onUpdate:modelValue":r[1]||(r[1]=r=>e.dialogVisible=r),title:"操作提示",width:"30%","close-on-click-modal":!1},{footer:(0,c.w5)((()=>[(0,c._)("span",g,[(0,c.Wm)(D,{onClick:e.hiddenDialog},{default:(0,c.w5)((()=>[(0,c.Uk)("取消")])),_:1},8,["onClick"]),(0,c.Wm)(D,{loading:e.loading,type:"primary",onClick:e.exchangeCreditFormValid,onKeyup:(0,f.D2)(e.exchangeCreditFormValid,["enter"])},{default:(0,c.w5)((()=>[(0,c.Uk)(" 确定 ")])),_:1},8,["loading","onClick","onKeyup"])])])),default:(0,c.w5)((()=>[(0,c.Wm)(k,{ref:"formRef","label-position":"top",rules:e.rules,model:e.formData},{default:(0,c.w5)((()=>[(0,c._)("h3",null,(0,u.zw)(e.dialogTips),1),(0,c.Wm)(W,{label:"积分兑换需要提供密码，请输入密码",prop:"password"},{default:(0,c.w5)((()=>[(0,c.Wm)(C,{modelValue:e.formData.password,"onUpdate:modelValue":r[0]||(r[0]=r=>e.formData.password=r),type:"password"},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"])],64)}var p=t(13517),w=t(11555);function h(){return(0,p.Z)({url:"/wwwapi.php?to=usercp&ac=credit&op=exchange",method:"get"})}async function b(e){const{body:{hash:r}}=await(0,w.Gv)();return(0,p.Z)({url:"/wwwapi.php?to=usercp&ac=credit&op=exchange",method:"post",data:{formhash:r,operation:"exchange",exchangesubmit:"true",outi:0,...e}})}var v=t(23051),y=t(90482);function D(...e){let r=new y.Z(e[0]);for(let t=1;t<e.length;t++)r=r.mul(new y.Z(e[t]));return r.toNumber()}var x={mul:D},V=t(2262),C=(0,c.aZ)({name:"Watermark",setup(){const e=(0,c.f3)("$baseMessage");(0,c.bv)((()=>{a()}));const r=(0,V.qj)({formData:{exchangeamount:0,tocredits:0,fromcredits:0,password:""},formTempData:{from_name:"",from_credits:0,to_name:"",to_credits:0},formOptionList:[],rules:v.UF,formRef:null,dialogVisible:!1,loading:!1});function t(e){return e.map((e=>{const r=e.t.map((e=>({credit_id:e.t,rate:parseFloat(e.rate),name:e.name,title:`${e.name}---兑率 ${e.rate}`}))),t=parseInt(e.score),a=e.to_credit_id??r[0].credit_id,o=r.find((e=>e.credit_id==a)),i=o?x.mul(t,o.rate):0;return{from_credit_id:e.f,from_name:e.name,from_credits:t,from_max_credits:t,to_credit_id:a,to_name:o?o.name:"",to_credits:i,rates:r}}))}async function a(){const{body:e}=await h();r.formOptionList=t(Object.values(e))}async function o(e){const r=e.rates.find((r=>r.credit_id==e.to_credit_id));let t=e.from_credits;t>e.from_max_credits&&(t=e.from_max_credits),e.to_credits=r?x.mul(t,r.rate):0,e.to_name=r?r.name:""}async function i(){const{body:e}=await h(),t=Object.values(e);r.formOptionList.map((e=>{const r=t.find((r=>r.f==e.from_credit_id));r&&(e.from_max_credits=parseInt(r.score),e.from_credits>e.from_max_credits&&(e.from_credits=e.from_max_credits,o(e)))}))}async function n(){try{r.loading=!0;const t=await b(r.formData);e(t.msg,"success","vab-hey-message-success"),i()}catch(t){}finally{r.formData.password="",r.loading=!1,r.dialogVisible=!1}}async function d(e){r.dialogVisible=!0,r.formTempData.from_credits=e.from_credits,r.formTempData.from_name=e.from_name,r.formTempData.to_credits=e.to_credits,r.formTempData.to_name=e.to_name,r.formData.exchangeamount=e.to_credits,r.formData.tocredits=e.to_credit_id,r.formData.fromcredits=e.from_credit_id}function l(){r["formRef"].validate((async e=>{e&&n()}))}function m(){r.formData.password="",r.loading=!1,r.dialogVisible=!1}return r.dialogTips=(0,c.Fl)((()=>`${r.formTempData.from_name} ${r.formTempData.from_credits} 兑换 ${r.formTempData.to_name} ${r.formTempData.to_credits}`)),{...(0,V.BK)(r),changeCreditRate:o,exchangeCreditPrompt:d,exchangeCreditFormValid:l,hiddenDialog:m}}});function W(e){e.__source="src/views/setting/tixian/components/formDuihuan.vue"}var k=t(83744);"function"===typeof W&&W(C);const U=(0,k.Z)(C,[["render",_]]);var T=U}}]);