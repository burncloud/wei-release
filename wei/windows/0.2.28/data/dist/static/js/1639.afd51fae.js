/*!
 *  build: Vue  Admin Plus
 *  copyright: vue-admin-beautiful.com
 *  time: 2023-10-21 18:47:55
 */
"use strict";(self["webpackChunkadmin_plus"]=self["webpackChunkadmin_plus"]||[]).push([[1639],{24025:function(t,e,s){s.d(e,{BB:function(){return o},BN:function(){return c},N7:function(){return k},NY:function(){return m},PM:function(){return h},Wx:function(){return u},Xq:function(){return f},Z0:function(){return p},iw:function(){return i},kA:function(){return d},l0:function(){return g},mE:function(){return w},wR:function(){return l},xS:function(){return b},yX:function(){return r},yo:function(){return y}});var a=s(52806),n=s(12688);function r(){return(0,a.Z)({url:"/wwwapi.php?to=sd&modac=tags",method:"get"})}function o(t){return(0,a.Z)({url:"/wwwapi.php?to=postSd",method:"get",params:t})}function i(t){const e={heat:{filter:"heat",orderby:"heats"},hot:{filter:"hot",orderby:""},digest:{filter:"digest",digest:"1"},lastpost:{filter:"lastpost",orderby:"lastpost"}},s={...e[t]};return s}function u(t){return(0,a.Z)({url:"/wwwapi.php?to=postSdTag",method:"get",params:t})}function c(t){return(0,a.Z)({url:"/wwwapi.php?to=postSdView&extra=",method:"get",params:t})}function l(t){return(0,a.Z)({url:"/wwwapi.php?to=postSdOfUser",method:"get",params:t})}async function m(t){const{body:{hash:e}}=await(0,n.Gv)();return(0,a.Z)({url:"/wwwapi.php?to=postReply",method:"post",data:{file:"",subject:"",usesig:"1",replysubmit:"yes",formhash:e,tid:t.tid,message:t.message}})}async function d(t){const{body:{hash:e}}=await(0,n.Gv)();return(0,a.Z)({url:"/wwwapi.php?to=postReply",method:"post",data:{subject:"",usesig:"1",replysubmit:"yes",formhash:e,...t}})}async function p(t){const{body:{hash:e}}=await(0,n.Gv)();return t.formhash=e,(0,a.Z)({url:"/wwwapi.php?to=postDel",method:"post",data:t})}async function g(t){const{body:{hash:e}}=await(0,n.Gv)();return(0,a.Z)({url:"/wwwapi.php?to=postFavAdd",method:"get",params:{id:t,formhash:e}})}async function f(t){const{body:{hash:e}}=await(0,n.Gv)();return(0,a.Z)({url:"/wwwapi.php?to=postFavDel",method:"post",data:{favid:t,formhash:e}})}function h(t){return(0,a.Z)({url:"/wwwapi.php?to=postFavlist",method:"get",params:t})}async function w(t){const{body:{hash:e}}=await(0,n.Gv)();return(0,a.Z)({url:"/wwwapi.php?to=postLikes",method:"get",params:{tid:t,hash:e}})}async function y(t){const{body:{hash:e}}=await(0,n.Gv)();return(0,a.Z)({url:"/wwwapi.php?to=postReport",method:"post",data:{referer:"",reportsubmit:"true",rtype:"post",url:"",inajax:"1",handlekey:`miscreport${t.rid}`,formhash:e,...t}})}async function b(t){const e={...t};e.tags=e.tags.join(",");const{body:{hash:s}}=await(0,n.Gv)();return(0,a.Z)({url:"/wwwapi.php?to=sd&modac=sharePrepare",method:"post",data:{formhash:s,...e}})}async function k(t){return(0,a.Z)({url:"/wwwapi.php?to=sdpost",method:"post",data:t})}},40645:function(t,e,s){s.d(e,{If:function(){return u},sP:function(){return c}});var a=s(95244),n=s(92327),r=s(17052),o=s(47720);const i=t=>{const e={"-3":"失败","-2":"任务创建中","-1":"任务等待",100:"完成 "};return e[t]??"进行中"},u=t=>t.map((t=>{const e=t,s=t.imagelist.map((t=>(t.checked=!!t.checked&&t.checked,t)));e.imagelist=s;const a=t.imagelist.map((t=>t.bigimg));e.images=a,e.collapse=t.collapse&&t.collapse.length>0?t.collapse:[],e.expired_at=e.ms_deleteTime??"任务进行中",e.created_at=(0,n.p)(1e3*e.ms_createTime);const r=parseInt(e.ms_state);return e.percentage=r<=0?0:r,e.ms_state_msg=i(e.ms_state),e.log=e.log?e.log:"",e})),c=(0,o.Q_)("imageResult",{state:()=>({tasks:[],queryForm:{page:1},pagination:{pageSize:1,total:1}}),getters:{getTasks(){return u(this.tasks)},getTasksImages(){return this.getTasks.map((t=>t.imagelist)).flat()},getTasksCheckedImages(){return this.getTasksImages.filter((t=>t.checked))},getProcessingTasks(){return this.getTasks.filter((t=>t.ms_state<100))},hasNoMoreData(){return(0,r.Gc)(this.queryForm.page,this.pagination.pageSize,this.pagination.total)}},actions:{async load(){return(0,a.ss)(this.queryForm).then((t=>{const{body:{list:e,page_perpage:s,page_allcount:a}}=t;return 1===this.queryForm.page?this.tasks=[...e]:this.tasks=[...this.tasks,...e],this.pagination.pageSize=parseInt(s),this.pagination.total=parseInt(a),!0}))},async loadData(){return this.queryForm.page=1,this.load()},async loadMore(){return this.queryForm.page++,this.load()},resetImagesCheck(){this.getTasksCheckedImages.forEach((t=>t.checked=!1))},async loadTasksProcess(){if(0===this.getProcessingTasks.length)return;const t=this.getProcessingTasks.map((t=>t.ms_id)),{body:{list:e}}=await(0,a.rt)({ms_ids:t});e.forEach((t=>{const e=this.getProcessingTasks.find((e=>e.ms_id==t.ms_id));e&&(e.ms_state=t.ms_state,e.ms_deleteTime=t.ms_deleteTime,e.log=t.log,t.imagelist.forEach(((t,s)=>{const a=e.imagelist[s];a.pic=t.pic,a.bigimg=t.bigimg})))}))}}})},92327:function(t,e,s){s.d(e,{E:function(){return i},p:function(){return u}});var a=s(27484),n=s.n(a),r=(s(33852),s(84110)),o=s.n(r);function i(t){return n().locale("zh-cn"),n()(t).fromNow()}function u(t,e="YYYY-MM-DD HH:mm:ss"){return n()(t).format(e)}n().extend(o())},17052:function(t,e,s){s.d(e,{D8:function(){return o},Gc:function(){return r},TD:function(){return a},Vj:function(){return n}});s(57658);function a(t,e){if(0===arguments.length)return null;const s=e||"{y}-{m}-{d} {h}:{i}:{s}";let a;"object"===typeof t?a=t:("string"===typeof t&&/^[0-9]+$/.test(t)&&(t=parseInt(t)),"number"===typeof t&&10===t.toString().length&&(t*=1e3),a=new Date(t));const n={y:a.getFullYear(),m:a.getMonth()+1,d:a.getDate(),h:a.getHours(),i:a.getMinutes(),s:a.getSeconds(),a:a.getDay()};return s.replace(/{([ymdhisa])+}/g,((t,e)=>{let s=n[e];return"a"===e?["日","一","二","三","四","五","六"][s]:(t.length>0&&s<10&&(s=`0${s}`),s||0)}))}function n(t=32){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";let s="";for(let a=0;a<t;a++)s+=e.charAt(Math.floor(Math.random()*e.length));return s}function r(t,e,s){const a=Math.ceil(s/e);return t>=a}function o(t=0){document.getElementById("app").scrollTo({top:t,left:0,behavior:"smooth"})}},29431:function(t,e,s){s.d(e,{Nb:function(){return r},jQ:function(){return a},jl:function(){return n}});const a={message:[{required:!0,message:"评论内容必填",trigger:"blur"},{min:10,message:"帖子长度必须大于10个字符",trigger:"blur"},{max:255,message:"帖子长度超过255个字符",trigger:"blur"}]},n={report_select:[{required:!0,message:"请选择举报类型",trigger:"blur"}],message:[{required:!0,message:"举报内容必填",trigger:"blur"},{min:8,max:255,message:"举报内容长度必须在8-255个字符",trigger:"blur"}]},r={images:[{required:!0,message:"发帖需要至少一张图片",trigger:"blur"}],subject:[{required:!0,message:"内容必填",trigger:"blur"}],tags:[{required:!0,message:"至少选择一个标签",trigger:"blur"}]}},21639:function(t,e,s){s.r(e),s.d(e,{default:function(){return q}});var a=s(4350),n=(s(3241),s(91103),s(73481)),r=(s(62029),s(20129)),o=(s(69840),s(15659)),i=(s(10444),s(57534)),u=(s(92471),s(57018)),c=(s(74367),s(6589),s(73632)),l=(s(74965),s(22040)),m=(s(99426),s(16273)),d=s(35756),p=(s(19414),s(57658),s(66252)),g=s(2262),f=s(3577),h=s(24025),w=s(40645),y=s(29431),b=s(22201),k=s(47720);const _={class:"share-form-container"},v={class:"lora-draw-card-body"},x={class:"lora-draw-image-group"},S={class:"lora-draw-image"};var T={__name:"shareform",setup(t,{expose:e}){const s=(0,b.tv)(),T=(0,p.f3)("$baseMessage"),j=(0,w.sP)(),{getTasksCheckedImages:Z}=(0,k.Jk)(j),D=(0,g.qj)({form:{images:[],subject:"",tags:[]},dialogFormVisible:!1,tagOptions:[],rules:{...y.Nb},formRef:null,postLoading:!1}),{dialogFormVisible:q,form:U,tagOptions:I,rules:F,formRef:C,postLoading:W}=(0,g.BK)(D);async function M(){const{body:t}=await(0,h.yX)();D.tagOptions=t.map((t=>({name:t,checked:!1})))}function V(t){const e=D.form.tags.findIndex((e=>e===t.name));e>=0||(t.checked=!0,D.form.tags.push(t.name))}async function G(t){const e=D.form.tags.findIndex((e=>e===t));if(e>=0){D.form.tags.splice(e,1);const s=D.tagOptions.find((e=>e.name===t));s&&(s.checked=!1)}}async function P(t){D.dialogFormVisible=!0,D.form.images=t}async function R(){D["formRef"].validate((t=>{t&&Y()}))}async function Y(){D.postLoading=!0;try{const{body:{data:t}}=await(0,h.xS)(D.form),{body:{tid:e}}=await(0,h.N7)(t);D.postLoading=!1,T("发帖成功","success","vab-hey-message-success"),s.push(`/topic/${e}`)}catch(t){}finally{D.postLoading=!1}}return(0,p.bv)((()=>{M()})),e({showDialog:P}),(t,e)=>{const s=d.F8,h=m.Z,w=l.Dv,y=c.dq,b=r.nH,k=u.EZ,T=i.Ks,j=o.ElButton,Z=r.ly,D=n.d0,M=a.t;return(0,p.wg)(),(0,p.iD)("div",_,[(0,p.Wm)(D,{modelValue:(0,g.SU)(q),"onUpdate:modelValue":e[2]||(e[2]=t=>(0,g.dq)(q)?q.value=t:null),title:"分享作品"},{default:(0,p.w5)((()=>[(0,p.Wm)(Z,{ref_key:"formRef",ref:C,model:(0,g.SU)(U),rules:(0,g.SU)(F),"label-width":"100px"},{default:(0,p.w5)((()=>[(0,p.Wm)(b,{prop:"images"},{default:(0,p.w5)((()=>[(0,p.Wm)(y,{gutter:16,span:"24",justify:"center"},{default:(0,p.w5)((()=>[((0,p.wg)(!0),(0,p.iD)(p.HY,null,(0,p.Ko)((0,g.SU)(U).images,(t=>((0,p.wg)(),(0,p.j4)(w,{key:t,lg:4,md:4,sm:4,xl:3,xs:12},{default:(0,p.w5)((()=>[(0,p.Wm)(h,{"body-style":{padding:"0px"},shadow:"hover"},{default:(0,p.w5)((()=>[(0,p._)("div",v,[(0,p._)("div",x,[(0,p._)("div",S,[(0,p.Wm)(s,{src:t},null,8,["src"])])])])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1}),(0,p.Wm)(b,{label:"标题",prop:"subject"},{default:(0,p.w5)((()=>[(0,p.Wm)(k,{modelValue:(0,g.SU)(U).subject,"onUpdate:modelValue":e[0]||(e[0]=t=>(0,g.SU)(U).subject=t),placeholder:"请发挥您的创意，大笔挥上贴近您作品的创意标题"},null,8,["modelValue"])])),_:1}),(0,p.Wm)(b,{label:"使用标签",prop:"tags"},{default:(0,p.w5)((()=>[((0,p.wg)(!0),(0,p.iD)(p.HY,null,(0,p.Ko)((0,g.SU)(U).tags,(t=>((0,p.wg)(),(0,p.j4)(T,{key:t,closable:"","disable-transitions":!1,style:{"margin-right":"10px","margin-bottom":"10px","margin-left":"0"},onClose:e=>G(t)},{default:(0,p.w5)((()=>[(0,p.Uk)((0,f.zw)(t),1)])),_:2},1032,["onClose"])))),128))])),_:1}),(0,p.Wm)(b,{label:"可选标签"},{default:(0,p.w5)((()=>[((0,p.wg)(!0),(0,p.iD)(p.HY,null,(0,p.Ko)((0,g.SU)(I),(t=>((0,p.wg)(),(0,p.j4)(T,{key:t.name,type:t.checked?"info":"","disable-transitions":!1,style:{"margin-right":"10px","margin-bottom":"10px","margin-left":"0"},class:(0,f.C_)({"cursor-pointer":!t.checked}),onClick:e=>V(t)},{default:(0,p.w5)((()=>[(0,p.Uk)((0,f.zw)(t.name),1)])),_:2},1032,["type","class","onClick"])))),128))])),_:1}),(0,p.Wm)(b,{label:""},{default:(0,p.w5)((()=>[(0,p.wy)(((0,p.wg)(),(0,p.j4)(j,{type:"primary",onClick:R},{default:(0,p.w5)((()=>[(0,p.Uk)(" 发布，欣赏下我的杰作吧 ")])),_:1})),[[M,(0,g.SU)(W)]]),(0,p.Wm)(j,{onClick:e[1]||(e[1]=t=>q.value=!1)},{default:(0,p.w5)((()=>[(0,p.Uk)(" 先不分享，缓缓 ")])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}}};function j(t){t.__source="src/views/stablediffusion/components/shareform.vue"}var Z=s(83744);"function"===typeof j&&j(T);const D=(0,Z.Z)(T,[["__scopeId","data-v-366809dd"]]);var q=D}}]);